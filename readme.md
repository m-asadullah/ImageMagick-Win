# Building ImageMagick on Windows

This guide describes the requirements and step-by-step instructions to build ImageMagick for Windows using Visual Studio.

---

## Requirements

- **Visual Studio:** Prefer the latest release (Community, Professional, or Enterprise).
- **Git for Windows:** For cloning repositories and subprojects.
- **AMD APP SDK (optional):** Only if you intend to enable OpenCL acceleration.

---

## Install Visual Studio components

Install the following components via Visual Studio Installer (Workloads and Individual components):

- **Desktop development with C++:** Core C++ toolchain and Windows SDK.
- **Visual C++ ATL build tools:** Required by some Windows targets.
- **Visual C++ MFC build tools:** Required by some Windows targets.

> Naming of components can vary between Visual Studio versions; select the closest available names that provide ATL/MFC and the C++ desktop workload.

---

## Prepare and clone repositories

1. **Open a developer shell:**  
   Use “x64 Native Tools Command Prompt for VS” or “Developer PowerShell for VS” to ensure the correct compiler toolset is on PATH.

2. **Choose a workspace directory:**  
   For example, `C:\src\imagemagick`.

3. **Clone the Windows build repository:**  
   ```bash
   git clone https://github.com/ImageMagick/Windows.git
   cd Windows
   ```

4. **Clone ImageMagick and third-party dependencies (IM7):**  
   ```bash
   .\clone-repositories-im7.cmd
   ```
   - **Alternative (legacy IM6):**  
     ```bash
     .\clone-repositories-im6.cmd
     ```

---

## Build Configure.exe

1. **Open the solution:**  
   Open `Configure/Configure.sln` in Visual Studio.

2. **Select configuration:**  
   Set Solution Configuration to **Release** and Solution Platform to **x64** (recommended for modern Windows).

3. **Build the Configure project:**  
   Build the `Configure` project. The output `Configure.exe` will be placed in `Configure/Artifacts`.

---

## Configure and build ImageMagick

1. **Run the configuration wizard:**  
   Execute `Configure\Artifacts\Configures\Configure.exe`. The wizard lets you choose:
   - **ImageMagick version:** IM7 (current) or IM6 (legacy).
   - **Components:** Core libraries and optional delegates.
   - **Features:** e.g., OpenCL (requires AMD APP SDK), HDRI, Q8/Q16 pixel depth.
   - **Linking preferences:** Dynamic vs. static as offered by the wizard.

2. **Open the generated solution:**  
   The wizard creates a Visual Studio solution in the repository root tailored to your selections.

3. **Build ImageMagick:**  
   - **Open the root solution:** In Visual Studio, open the solution generated by the wizard.
   - **Select configuration:** Use **Release | x64** unless you have a specific need for Debug or Win32.
   - **Build:** Build the solution. Binaries and libraries will be placed under the `Artifacts` directory.

---

## Outputs, verification, and notes

- **Artifacts location:**  
  Built executables, DLLs, and libraries are emitted under `Artifacts` (subfolders may vary by configuration).

- **Quick verification:**  
  - **Command prompt:** Run `magick -version` or `magick identify -version` from the Artifacts bin folder to confirm a working build.
  - **Dependency check:** Use your preferred tool to verify that expected delegates and runtime dependencies are present.

- **OpenCL note:**  
  Enabling OpenCL requires compatible drivers and the AMD APP SDK. If OpenCL is not needed, leave it disabled for a simpler, more portable build.

- **Common troubleshooting:**  
  - **Missing ATL/MFC:** Install the ATL/MFC components if the solution fails to build related projects.  
  - **Architecture mismatch:** Ensure you build and run consistently for x64 (both toolchain and dependencies).  
  - **SDK/toolset issues:** If Windows SDK or MSVC toolset errors appear, update the “Desktop development with C++” workload in Visual Studio Installer and retry.

